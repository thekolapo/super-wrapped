<template>
  <div class="wrapped">
    <header class="wrapped__header">
      <nav class="wrapped__nav" aria-label="Primary Navigation">
        <ul class="wrapped__nav-menu">
          <li>
            <a href="/2025-wrapped">
              <svg
                class="wrapped__nav-logo"
                width="84"
                height="28"
                viewBox="0 0 84 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_262_1144)">
                  <path
                    d="M50.9058 14.0822C50.9058 18.1084 47.3221 21.7794 43.3835 21.7794C40.3578 21.7794 38.1602 19.5125 38.1602 16.3828C38.1602 12.3566 41.7438 8.68562 45.6824 8.68562C48.7083 8.68562 50.9058 10.9525 50.9058 14.0822ZM49.2154 15.2155C49.2154 12.5427 47.1362 10.3773 44.5668 10.3773C41.9974 10.3773 39.8506 12.5934 39.8506 15.2494C39.8506 17.9054 41.9298 20.0877 44.4992 20.0877C47.0686 20.0877 49.2154 17.8715 49.2154 15.2155ZM47.8631 16.3828C47.8631 17.6855 46.9841 18.5652 45.6487 18.5652C43.485 18.5652 41.2029 16.2645 41.2029 14.0822C41.2029 12.7795 42.0819 11.8998 43.4174 11.8998C45.5811 11.8998 47.8631 14.2005 47.8631 16.3828ZM35.0837 27.5818H39.5801V22.1177C40.7803 23.4034 42.5721 24.1308 44.5161 24.1308C49.4014 24.1308 52.8836 20.4598 52.8836 15.3002C52.8836 10.1405 49.4014 6.4695 44.5161 6.4695C42.5721 6.4695 40.7803 7.19693 39.5801 8.4657V6.84167H35.0837V27.5818ZM44.533 16.8735C43.6371 16.8735 42.8933 16.1291 42.8933 15.2325C42.8933 14.3359 43.6202 13.5915 44.533 13.5915C45.4458 13.5915 46.1727 14.3359 46.1727 15.2325C46.1727 16.1291 45.4628 16.8735 44.533 16.8735Z"
                    fill="white"
                  />
                  <path
                    d="M73.4727 6.78277H77.9692V9.01581C78.9154 7.3072 80.9446 6.29218 83.0738 6.49519V10.6229C80.1162 10.1831 77.9692 11.7902 77.9692 14.4462V23.6998H73.4727V6.78277ZM16.6921 17.1698V6.78277H21.1885V16.5438C21.1885 19.1491 22.2197 20.4009 24.1806 20.4009C26.2936 20.4009 27.8825 18.6754 27.8825 16.3747V6.78277H32.379V23.6998H27.8825V21.3314C26.8852 23.04 24.9582 24.0719 22.9973 24.0719C18.9742 24.0719 16.6921 21.5682 16.6921 17.1698Z"
                    fill="white"
                  />
                  <path
                    d="M12.221 14.7081C11.3758 14.2259 10.3363 13.8368 9.09549 13.5408C8.19957 13.2938 7.4879 13.0654 6.9588 12.8557C6.42971 12.6459 6.05614 12.4243 5.833 12.1891C5.60987 11.954 5.4983 11.6884 5.4983 11.3923C5.4983 10.9474 5.68931 10.5956 6.07134 10.3367C6.45337 10.0779 6.99937 9.94763 7.71103 9.94763C8.34326 9.94763 9.06841 10.083 9.88657 10.3553C10.703 10.6277 11.4417 11.01 12.101 11.504L14.3171 8.46739C13.4466 7.82455 12.4391 7.33057 11.2913 6.98547C10.1452 6.64374 8.98049 6.4695 7.79387 6.4695C6.4483 6.4695 5.2684 6.68603 4.25417 7.11742C3.23993 7.55049 2.4353 8.14259 1.84027 8.8937C1.24694 9.6482 0.95112 10.5177 0.95112 11.504C0.95112 12.4903 1.18778 13.3699 1.66278 14.0585C2.13778 14.7504 2.8224 15.3188 3.72 15.7637C4.61591 16.2086 5.69777 16.5909 6.96388 16.9124C7.80572 17.1593 8.47172 17.3758 8.96026 17.5602C9.4488 17.7464 9.79026 17.9443 9.98803 18.1524C10.1858 18.3622 10.2838 18.6277 10.2838 18.9492C10.2838 19.4685 10.0472 19.8813 9.57218 20.1908C9.09718 20.5005 8.46495 20.6544 7.67384 20.6544C6.77794 20.6544 5.86174 20.4683 4.92526 20.0978C3.99047 19.7273 3.09793 19.208 2.25611 18.5415L0.00280762 21.6508C1.18947 22.4915 2.41501 23.1124 3.68112 23.5202C4.94723 23.9278 6.27757 24.1308 7.67384 24.1308C9.94064 24.1308 11.7021 23.6436 12.953 22.6692C14.2056 21.6931 14.831 20.4175 14.831 18.8358C14.831 17.9223 14.6079 17.1272 14.1583 16.4472C13.7086 15.7671 13.0646 15.1868 12.2193 14.7047V14.7098L12.221 14.7081Z"
                    fill="white"
                  />
                  <path
                    d="M70.3353 10.8019C69.5814 9.46887 68.5654 8.41326 67.2824 7.63507C66.001 6.85859 64.544 6.4695 62.9161 6.4695C61.2882 6.4695 59.8564 6.85859 58.5498 7.63507C57.2431 8.41326 56.2069 9.47395 55.4411 10.8205C54.6754 12.1654 54.295 13.666 54.295 15.3188C54.295 16.9715 54.6889 18.467 55.48 19.7984C56.2694 21.1332 57.3547 22.1871 58.7374 22.9652C60.1185 23.7435 61.6737 24.1308 63.3995 24.1308C64.7333 24.1308 65.9774 23.9025 67.1354 23.4457C68.2933 22.9889 69.3311 22.3156 70.244 21.4275L67.727 18.6869C67.0846 19.3044 66.4 19.7561 65.6731 20.0403C64.9446 20.3245 64.15 20.4666 63.2863 20.4666C62.3481 20.4666 61.5164 20.245 60.7879 19.8001C60.0593 19.3552 59.4812 18.7495 59.0484 17.9866C58.8524 17.6415 58.707 17.2693 58.5988 16.8768H71.314C71.363 16.6552 71.4002 16.4015 71.4256 16.1172C71.4492 15.8331 71.4627 15.5556 71.4627 15.2832C71.4627 13.6305 71.0858 12.135 70.3353 10.8036H70.337L70.3353 10.8019ZM58.6039 13.6541C58.6968 13.2955 58.8203 12.9555 58.9757 12.6374C59.3578 11.8592 59.8954 11.2435 60.585 10.7867C61.2764 10.33 62.0404 10.1016 62.8789 10.1016C63.768 10.1016 64.549 10.33 65.2286 10.7867C65.9081 11.2435 66.4423 11.8491 66.8378 12.6002C67.0119 12.9301 67.1455 13.2853 67.2435 13.6541H58.6039Z"
                    fill="white"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_262_1144">
                    <rect
                      width="83.0769"
                      height="22"
                      fill="white"
                      transform="translate(0 6)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </a>
          </li>
        </ul>
      </nav>
    </header>
    <main>
      <div class="wrapped-progress">
        <ol class="wrapped-progress__list">
          <li
            v-for="(item, index) in slideCount"
            :key="index"
            class="wrapped-progress__step"
            :class="{
              'wrapped-progress__step--active': index === slideIndex,
            }"
          />
        </ol>
      </div>
      <div class="wrapped-carousel" ref="wrappedCarousel">
        <div class="wrapped-carousel__cell">
          <article class="wrapped-card wrapped-card--intro">
            <span class="wrapped-card__label u-text-xs">
              YOUR YEAR with SUPER
            </span>
            <h1
              class="wrapped-card__animated-text u-text-h1"
              ref="introHeading"
            >
              Hi {{ wrappedData.user.firstName }}, let's unwind together
            </h1>
            <p class="wrapped-card__body wrapped-card__animated-text">
              Here's how you worked, built and made impact this year.
            </p>
            <button
              class="wrapped-card__button c-button"
              @click="handleNavigationButtonClick(SlideDirection.NEXT)"
            >
              Let's begin
            </button>
          </article>
        </div>
        <div class="wrapped-carousel__cell">
          <article class="wrapped-card wrapped-card--cream">
            <h2 class="u-text-h1 u-text-h1--alt u-font-mono">
              {{ searchesValue }}
            </h2>
            <p class="wrapped-card__body wrapped-card__animated-text">
              You made {{ wrappedData.searches.total }} searches with Super this
              year. That's thousands of moments you found answers fast without
              breaking your flow.
            </p>
            <button class="wrapped-card__button c-button c-button--alt">
              Share this story
            </button>
            <div
              id="js-matter-physics"
              class="wrapped-card__matter-container"
            />
          </article>
        </div>
        <div class="wrapped-carousel__cell">
          <WrappedSplitCard
            variant="blue"
            :heading="`${wrappedData.hoursReclaimed} hours reclaimed`"
            body="A full month ~ 20 days of work reclaimed. Instead of hunting for
          answers, you helped customers, solved problems fast, and kept the team
          moving."
            button-text="Share story"
            illustration-class="wrapped-card__illustration--grid"
          />
        </div>
        <div class="wrapped-carousel__cell">
          <WrappedSplitCard
            variant="cream"
            label="YOUR PEAK MONTH"
            :heading="`${wrappedData.peakMonth.name} was your Super month ‚ö°`"
            :body="`You created ${wrappedData.peakMonth.docsCreated} support articles in Slite, escalated ${wrappedData.peakMonth.escalations.total} issues to ${wrappedData.peakMonth.escalations.tool} , and resolved ${wrappedData.peakMonth.resolvedConversations.total} conversations in ${wrappedData.peakMonth.resolvedConversations.tool} ‚Äì your fastest in just ${wrappedData.peakMonth.fastestResolutionSeconds} seconds.`"
            button-text="Share story"
            button-class="c-button--alt"
          >
            <template #illustration>
              <svg
                class="wrapped-card__illustration"
                width="489"
                height="473"
                viewBox="0 0 489 473"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <ellipse
                  cx="270.7"
                  cy="267.175"
                  rx="195.586"
                  ry="195.586"
                  transform="rotate(30 270.7 267.175)"
                  fill="#232323"
                />
                <g class="circle-badge">
                  <ellipse
                    cx="219.6"
                    cy="242.034"
                    rx="195.586"
                    ry="195.586"
                    fill="#176BE5"
                  />
                  <path
                    d="M186.101 298.009C186.726 298.634 186.726 299.602 186.101 300.226L175.038 311.282C174.726 311.594 174.32 311.75 173.945 311.75C173.57 311.75 173.132 311.594 172.851 311.282C172.226 310.657 172.226 309.689 172.851 309.064L183.914 298.009C184.539 297.384 185.508 297.384 186.133 298.009H186.101ZM175.038 286.953C174.413 286.329 173.445 286.329 172.82 286.953L161.757 298.009C161.132 298.634 161.132 299.602 161.757 300.226C162.069 300.539 162.475 300.695 162.85 300.695C163.225 300.695 163.663 300.539 163.944 300.226L175.007 289.171C175.632 288.546 175.632 287.578 175.007 286.953H175.038ZM256.823 205.255C260.949 209.377 263.23 214.874 263.23 220.714C263.23 226.554 260.949 232.051 256.823 236.173C252.698 240.295 246.948 242.575 241.354 242.575C235.76 242.575 230.166 240.451 225.884 236.173C217.353 227.647 217.353 213.781 225.884 205.255C230.01 201.133 235.51 198.853 241.354 198.853C247.198 198.853 252.698 201.133 256.823 205.255ZM260.105 220.714C260.105 215.717 258.167 211.001 254.605 207.472C251.073 203.943 246.354 201.976 241.354 201.976C236.354 201.976 231.635 203.912 228.103 207.472C220.791 214.78 220.791 226.679 228.103 233.987C235.416 241.295 247.323 241.295 254.636 233.987C258.167 230.458 260.136 225.742 260.136 220.745L260.105 220.714ZM254.636 258.034C257.23 293.855 216.915 311.625 215.196 312.375C215.009 312.469 214.79 312.5 214.571 312.5C214.29 312.5 214.009 312.406 213.79 312.25C213.79 312.25 213.759 312.25 213.728 312.219C213.634 312.156 213.54 312.125 213.478 312.063C213.384 311.969 213.384 311.844 213.321 311.75C213.259 311.688 213.196 311.625 213.165 311.563C213.134 311.469 213.134 311.375 213.103 311.313C213.103 311.219 213.04 311.126 213.04 311.032C213.04 310.751 213.103 310.501 213.228 310.251C213.228 310.22 213.228 310.157 213.228 310.126C214.79 306.785 218.978 296.791 218.603 287.203C207.102 293.824 199.258 296.041 198.664 296.198C198.539 296.229 198.383 296.26 198.258 296.26C197.852 296.26 197.446 296.104 197.164 295.792L166.226 264.874C165.819 264.468 165.663 263.905 165.819 263.343C165.975 262.781 168.194 254.911 174.82 243.418C165.069 243.012 154.912 247.353 151.85 248.79C151.6 248.915 151.319 249.009 151.069 249.009C150.662 249.009 150.287 248.852 149.975 248.571C149.506 248.103 149.412 247.385 149.662 246.822C150.475 244.949 168.257 204.849 204.008 207.41C225.447 187.61 245.948 179.459 259.761 176.117C275.887 172.213 286.45 173.806 286.887 173.9C287.544 173.993 288.075 174.524 288.2 175.211C288.262 175.617 294.013 215.53 254.636 258.034ZM176.632 240.451C181.757 232.113 189.039 222.182 199.352 211.876C199.821 211.376 200.321 210.939 200.79 210.47C188.102 210.47 176.413 216.154 166.007 227.616C160.288 233.924 156.413 240.42 154.319 244.355C159.6 242.294 168.288 239.64 176.632 240.42V240.451ZM251.604 261.22C251.136 261.688 250.698 262.188 250.198 262.656C239.885 272.962 229.947 280.27 221.603 285.361C222.384 293.699 219.697 302.412 217.665 307.659C221.603 305.567 228.103 301.694 234.416 295.979C245.885 285.579 251.604 273.899 251.573 261.22H251.604ZM285.231 176.867C278.168 176.242 240.573 175.118 201.571 214.093C178.445 237.204 170.538 258.846 169.101 263.343L198.696 292.918C203.196 291.451 224.853 283.581 247.979 260.47C286.981 221.495 285.856 183.925 285.231 176.867ZM164.007 275.929C163.382 275.304 162.413 275.304 161.788 275.929L150.725 286.985C150.1 287.609 150.1 288.577 150.725 289.202C151.037 289.514 151.444 289.67 151.819 289.67C152.194 289.67 152.631 289.514 152.912 289.202L163.975 278.146C164.6 277.522 164.6 276.554 163.975 275.929H164.007Z"
                    fill="url(#paint0_linear_176_2523)"
                  />
                </g>

                <defs>
                  <linearGradient
                    id="paint0_linear_176_2523"
                    x1="134.527"
                    y1="242.5"
                    x2="310.027"
                    y2="246.5"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop stop-color="#F7F0E5" />
                    <stop offset="0.798077" stop-color="#FFD2E1" />
                  </linearGradient>
                </defs>
              </svg>
            </template>
          </WrappedSplitCard>
        </div>
        <div class="wrapped-carousel__cell">
          <WrappedSplitCard
            variant="pink"
            label="YOUR ARCHETYPE"
            :heading="`${wrappedData.archetype.name}`"
            :body="`You don't just respond, you resolve. Across ${
              wrappedData.archetype.conversations
            } Intercom conversations, ${
              wrappedData.archetype.resolutionRate * 100
            }% were solved on first response. Only ${
              wrappedData.archetype.percentile
            }% of users share this archetype.`"
            button-text="Share story"
            button-class="c-button--alt"
          >
            <template #illustration>
              <svg
                class="wrapped-card__illustration"
                width="542"
                height="501"
                viewBox="0 0 542 501"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <ellipse
                  cx="324.36"
                  cy="295.792"
                  rx="195.586"
                  ry="195.586"
                  transform="rotate(33.5788 324.36 295.792)"
                  fill="#232323"
                />
                <g class="circle-badge">
                  <ellipse
                    class="ellipse"
                    cx="275.022"
                    cy="271.123"
                    rx="195.586"
                    ry="195.586"
                    transform="rotate(33.5788 275.022 271.123)"
                    fill="#176BE5"
                  />
                  <path
                    d="M269.883 328.376C271.148 329.641 272.838 330.27 274.498 330.27C276.157 330.27 277.848 329.641 279.113 328.376L295.888 311.73C297.387 313.038 299.016 314.21 300.75 315.204V352.259C300.75 353.271 301.287 354.172 302.157 354.659C302.57 354.894 303.008 355.005 303.452 355.005C303.958 355.005 304.464 354.863 304.908 354.591L314.657 348.397L324.405 354.591C325.244 355.11 326.287 355.147 327.15 354.672C328.02 354.197 328.557 353.283 328.557 352.272V315.216C337.293 310.286 343.229 300.908 343.229 290.136C343.229 282.966 340.588 276.426 336.263 271.386C341.273 265.34 344 257.819 344 249.872C344 240.84 340.446 232.326 334.005 225.909C320.721 212.718 299.085 212.718 285.8 225.909L274.651 236.996C274.651 236.996 274.417 237.076 274.337 236.996L263.2 225.921C256.74 219.523 248.177 216 239.082 216C229.981 216 221.406 219.523 214.995 225.921C208.554 232.331 205 240.846 205 249.897C205 258.948 208.554 267.462 214.995 273.861L269.881 328.414L269.883 328.376ZM308.469 348.637L303.842 351.593V316.702C305.328 317.301 306.889 317.794 308.469 318.158V348.644V348.637ZM317.742 346.681L316.101 345.639C315.657 345.355 315.151 345.225 314.645 345.225C314.139 345.225 313.633 345.367 313.189 345.639L311.548 346.681V318.678C312.572 318.789 313.584 318.85 314.645 318.85C315.706 318.85 316.712 318.789 317.742 318.678L317.742 346.681ZM325.467 351.593L320.839 348.637V318.152C322.437 317.807 323.98 317.301 325.467 316.696V351.593ZM340.138 290.117C340.138 304.252 328.706 315.751 314.663 315.751C300.621 315.751 289.188 304.251 289.188 290.117C289.188 275.983 300.621 264.482 314.663 264.482C328.706 264.482 340.138 275.983 340.138 290.117ZM217.163 228.117C223.024 222.286 230.792 219.097 239.072 219.097C247.346 219.097 255.151 222.305 261.012 228.117L272.149 239.191C273.426 240.469 275.53 240.469 276.807 239.191L287.956 228.117C300.055 216.11 319.706 216.11 331.804 228.117C337.666 233.947 340.886 241.666 340.886 249.883C340.886 256.972 338.468 263.685 334.063 269.139C328.96 264.369 322.136 261.414 314.634 261.414C298.888 261.414 286.061 274.284 286.061 290.146C286.061 297.648 288.967 304.454 293.656 309.588L276.911 326.203C275.566 327.548 273.376 327.548 272.031 326.203L217.163 271.657C211.302 265.826 208.082 258.108 208.082 249.878C208.082 241.647 211.302 233.922 217.163 228.098L217.163 228.117Z"
                    fill="url(#paint0_linear_176_2523)"
                  />
                  <path
                    d="M314.651 270.048C303.576 270.048 294.574 279.05 294.574 290.125C294.574 301.2 303.576 310.201 314.651 310.201C325.726 310.201 334.727 301.2 334.727 290.125C334.727 279.05 325.726 270.048 314.651 270.048ZM314.651 307.117C305.267 307.117 297.653 299.503 297.653 290.119C297.653 280.734 305.266 273.12 314.651 273.12C324.035 273.12 331.649 280.734 331.649 290.119C331.649 299.503 324.035 307.117 314.651 307.117Z"
                    fill="url(#paint1_linear_176_2523)"
                  />
                </g>

                <defs>
                  <linearGradient
                    id="paint0_linear_176_2523"
                    x1="195.5"
                    y1="227.5"
                    x2="325.5"
                    y2="299"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop stop-color="#F7F0E5" />
                    <stop offset="1" stop-color="#FFD2E1" />
                  </linearGradient>

                  <linearGradient
                    id="paint1_linear_176_2523"
                    x1="291.83"
                    y1="273.37"
                    x2="329.382"
                    y2="294.025"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop stop-color="#F7F0E5" />
                    <stop offset="1" stop-color="#FFD2E1" />
                  </linearGradient>
                </defs>
              </svg>
            </template>
          </WrappedSplitCard>
        </div>
        <div class="wrapped-carousel__cell">
          <article class="wrapped-card wrapped-card--blue">
            <span class="wrapped-card__label u-text-xs">Your Work Themes</span>
            <h2 class="wrapped-card__animated-text u-text-h1">
              Your Year in Three Words
            </h2>
            <div class="wrapped-card__cardswrapper">
              <div class="wrapped-card__card wrapped-card__card--small">
                <h3 class="wrapped-card__card-gradient u-text-h3 u-text-black">
                  {{ wrappedData.themes.words[0] }} .
                  {{ wrappedData.themes.words[1] }} .
                  {{ wrappedData.themes.words[2] }}
                </h3>
              </div>
              <div class="wrapped-card__card">
                <p>
                  {{ wrappedData.themes.percentageOccurence }}% of your
                  searches, conversations, and docs lived here. When things got
                  complicated, teams came to you ü´°
                </p>
              </div>
            </div>
          </article>
        </div>
        <div class="wrapped-carousel__cell">
          <article class="wrapped-card wrapped-card--blue">
            <span class="wrapped-card__label u-text-xs">Most Used phrases</span>
            <h2 class="wrapped-card__animated-text u-text-h1">
              Your Most Used Phrases
            </h2>
            <div class="wrapped-card__cardswrapper">
              <div
                class="wrapped-card__card wrapped-card__card--small"
                v-for="(item, index) in wrappedData.themes.topPhrases"
                :key="index"
              >
                <p class="u-text-h3 u-text-black">
                  <span class="wrapped-card__card-gradient">
                    "{{ item.phrase }}"
                  </span>
                  x{{ item.occurrence }} times
                  <span>
                    {{ item.occurrence > 199 ? "ü§Ø" : "üòÖ" }}
                  </span>
                </p>
              </div>
            </div>
          </article>
        </div>
        <div class="wrapped-carousel__cell">
          <WrappedSplitCard
            variant="blue"
            label="Knowledge creator"
            :heading="`${wrappedData.docs.created} Docs created`"
            :body="`You authored ${wrappedData.docs.created} documentation pages in Slite this year, and your '${wrappedData.docs.topDoc.title}' was viewed ${wrappedData.docs.topDoc.viewed} times by ${wrappedData.docs.topDoc.viewers} teammates. You're literally writing the playbook.`"
            button-text="Share story"
            illustration-class="wrapped-card__illustration--grid"
          />
        </div>
        <div class="wrapped-carousel__cell">
          <article
            class="wrapped-card wrapped-card--split wrapped-card--summary wrapped-card--blue"
          >
            <div class="wrapped-card__copy">
              <span class="wrapped-card__label u-text-xs">
                your 2025 wrapped
              </span>
              <p class="u-text-h1">
                <span class="wrapped-card__copy-gradient">
                  {{ wrappedData.searches.total }} searches
                </span>
                ü§Ø
              </p>
              <p class="u-text-h2">
                <span
                  class="wrapped-card__copy-gradient wrapped-card__copy-gradient--orange"
                >
                  {{ wrappedData.hoursReclaimed }} hours reclaimed
                </span>
                üíÜüèº
              </p>
              <p class="u-text-h3">
                <span
                  class="wrapped-card__copy-gradient wrapped-card__copy-gradient--pink"
                >
                  {{ wrappedData.archetype.resolutionRate * 100 }}% resolution
                  rate
                </span>
                ‚ö°
              </p>
              <button class="wrapped-card__button c-button">
                Share your wrapped
              </button>
            </div>
            <svg
              class="wrapped-card__illustration"
              width="505"
              height="440"
              viewBox="0 0 505 440"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <ellipse
                cx="308.879"
                cy="240.665"
                rx="195.586"
                ry="195.586"
                fill="#232323"
              />
              <ellipse
                cx="195.586"
                cy="195.586"
                rx="195.586"
                ry="195.586"
                fill="#176BE5"
              />
            </svg>
          </article>
        </div>
      </div>
      <div class="wrapped__scroll-buttons" v-if="!isSmallScreen">
        <button
          class="wrapped__scroll-button"
          @click="handleNavigationButtonClick(SlideDirection.PREVIOUS)"
        >
          <svg
            width="27"
            height="15"
            viewBox="0 0 27 15"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M0.292918 6.65691C-0.0976063 7.04743 -0.0976063 7.6806 0.292918 8.07112L6.65688 14.4351C7.0474 14.8256 7.68057 14.8256 8.07109 14.4351C8.46162 14.0446 8.46162 13.4114 8.07109 13.0209L2.41424 7.36401L8.07109 1.70716C8.46162 1.31664 8.46162 0.68347 8.07109 0.292946C7.68057 -0.0975784 7.0474 -0.0975784 6.65688 0.292946L0.292918 6.65691ZM26.02 7.36401V6.36401L1.00002 6.36401V7.36401V8.36401L26.02 8.36401V7.36401Z"
              fill="white"
              fill-opacity="0.7"
            />
          </svg>
        </button>
        <button
          class="wrapped__scroll-button"
          @click="handleNavigationButtonClick(SlideDirection.NEXT)"
        >
          <svg
            width="27"
            height="15"
            viewBox="0 0 27 15"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M25.7271 8.07112C26.1176 7.6806 26.1176 7.04743 25.7271 6.65691L19.3631 0.292946C18.9726 -0.0975784 18.3395 -0.0975784 17.9489 0.292946C17.5584 0.68347 17.5584 1.31664 17.9489 1.70716L23.6058 7.36401L17.9489 13.0209C17.5584 13.4114 17.5584 14.0446 17.9489 14.4351C18.3395 14.8256 18.9726 14.8256 19.3631 14.4351L25.7271 8.07112ZM0 7.36401L0 8.36401L25.02 8.36401V7.36401V6.36401L0 6.36401L0 7.36401Z"
              fill="white"
              fill-opacity="0.7"
            />
          </svg>
        </button>
      </div>
    </main>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from "vue";
import { useMatterPhysics } from "~/composables/useMatterPhysics";
import WrappedSplitCard from "~/components/WrappedSplitCard.vue";

const { initPhysicsEngine, destroyPhysicsEngine } = useMatterPhysics();

const wrappedCarousel = ref(null);
const introHeading = ref(null);
const SlideDirection = {
  NEXT: "next",
  PREVIOUS: "previous",
};
const isMatterEngineInitialized = ref(false);
const flickity = ref(null);
const slideIndex = ref(0);
const slideCount = ref(0);

const wrappedData = {
  user: {
    firstName: "Kolapo",
  },
  searches: {
    total: 2975,
    months: [
      { name: "JAN : 245", color: "#FF824D" },
      { name: "FEB : 273", color: "##FF824D" },
      { name: "MAR : 221", color: "#176BE5" },
      { name: "APR : 152", color: "#EF91F7" },
      { name: "MAY : 183", color: "#FF9FBE" },
      { name: "JUN : 192", color: "#232323" },
      { name: "JUL : 190", color: "#176BE5" },
      { name: "AUG : 180", color: "#FF824D" },
      { name: "SEP : 220", color: "#232323" },
      { name: "OCT : 200", color: "#176BE5" },
      { name: "NOV : 210", color: "#54C3FF" },
      { name: "DEC : 195", color: "#FF9FBE" },
    ],
  },
  hoursReclaimed: 240,
  peakMonth: {
    name: "May",
    escalations: {
      total: 23,
      tool: "Jira",
    },
    resolvedConversations: {
      total: 230,
      tool: "Intercom",
    },
    fastestResolutionSeconds: 43,
    docsCreated: 10,
  },
  archetype: {
    name: "The Closer ‚ö°",
    conversations: 970,
    resolutionRate: 0.89,
    percentile: 2.1,
  },
  themes: {
    words: ["Refunds", "Compliance", "Chargeback"],
    percentageOccurence: 73,
    topPhrases: [
      {
        phrase:
          "I'm glad to hear that, you can reach out if you have any other issues.",
        occurrence: 203,
      },
      {
        phrase: "Alright, I'll look into that shortly.",
        occurrence: 132,
      },
    ],
  },
  docs: {
    created: 19,
    topDoc: {
      title: "CAC Lookup Guide",
      views: 731,
      viewers: 56,
    },
  },
};

const moveSlide = (direction) => {
  flickity.value[direction === SlideDirection.NEXT ? "next" : "previous"]();
};

const animateSlideText = () => {
  const currentSlide = flickity.value.cells[slideIndex.value].element;
  const textElements = currentSlide.querySelectorAll(
    ".wrapped-card__animated-text"
  );

  textElements.forEach((element) => {
    // reset animation
    const spans = element.querySelectorAll("span");
    spans.forEach((span) => {
      span.style.animation = "none";
      span.offsetHeight; // Trigger reflow
      span.style.animation = null;
    });
  });
};

const handleNavigationButtonClick = (direction) => {
  moveSlide(direction);
};

const searchesValue = ref(0);

const initSearchesCounterAnimation = () => {
  const target = wrappedData.searches.total;
  const duration = 2000;
  let startTime = null;

  const animate = (timestamp) => {
    if (!startTime) startTime = timestamp;

    const progress = timestamp - startTime;
    const percentage = Math.min(progress / duration, 1);

    searchesValue.value = Math.floor(percentage * target);

    if (percentage < 1) {
      requestAnimationFrame(animate);
    }
  };

  requestAnimationFrame(animate);
};

const deconstructText = (element) => {
  const wordsArray = element.innerText.split(" ");
  element.innerText = "";
  element.style.opacity = 1;

  wordsArray.forEach((word) => {
    let innerContent = "";
    word.split("").forEach((char) => {
      innerContent += `<span>${char}</span>`;
    });

    const div = document.createElement("div");
    div.innerHTML = innerContent + " ";
    element.appendChild(div);
  });
};

const isSmallScreen = computed(() => window.innerWidth <= 500);

onMounted(async () => {
  const Flickity = (await import("flickity")).default;
  flickity.value = new Flickity(wrappedCarousel.value, {
    draggable: isSmallScreen.value || false,
    dragThreshold: 15,
    adaptiveHeight: true,
    cellAlign: "left",
    contain: true,
    pageDots: false,
    prevNextButtons: false,
    selectedAttraction: 0.1,
    friction: 0.7,
  });

  flickity.value.on("change", (index) => {
    slideIndex.value = index;

    setTimeout(() => {
      animateSlideText();
    }, 50);

    switch (slideIndex.value) {
      case 1:
        initSearchesCounterAnimation();

        if (!isMatterEngineInitialized.value) {
          initPhysicsEngine("js-matter-physics", wrappedData.searches.months, {
            useSprite: false,
          });
          isMatterEngineInitialized.value = true;
        }
        break;

      default:
        break;
    }
  });

  slideCount.value = flickity.value.slides.length;

  const animatedTextElements = wrappedCarousel.value.querySelectorAll(
    ".wrapped-card__animated-text"
  );
  animatedTextElements.forEach((element) => {
    deconstructText(element);
  });
  // trigger animation for first slide
  animateSlideText();
});

onUnmounted(() => {
  flickity.value?.destroy();
  destroyPhysicsEngine();
});
</script>

<style lang="scss">
@use "@/assets/scss/pages/wrapped";
@import "flickity/css/flickity.css";
</style>
