<template>
  <div class="home">
    <header class="header">
      <nav class="nav" aria-label="Primary Navigation">
        <ul class="nav__menu">
          <li>
            <a href="" target="">
              <svg
                width="84"
                height="28"
                viewBox="0 0 84 28"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_262_1144)">
                  <path
                    d="M50.9058 14.0822C50.9058 18.1084 47.3221 21.7794 43.3835 21.7794C40.3578 21.7794 38.1602 19.5125 38.1602 16.3828C38.1602 12.3566 41.7438 8.68562 45.6824 8.68562C48.7083 8.68562 50.9058 10.9525 50.9058 14.0822ZM49.2154 15.2155C49.2154 12.5427 47.1362 10.3773 44.5668 10.3773C41.9974 10.3773 39.8506 12.5934 39.8506 15.2494C39.8506 17.9054 41.9298 20.0877 44.4992 20.0877C47.0686 20.0877 49.2154 17.8715 49.2154 15.2155ZM47.8631 16.3828C47.8631 17.6855 46.9841 18.5652 45.6487 18.5652C43.485 18.5652 41.2029 16.2645 41.2029 14.0822C41.2029 12.7795 42.0819 11.8998 43.4174 11.8998C45.5811 11.8998 47.8631 14.2005 47.8631 16.3828ZM35.0837 27.5818H39.5801V22.1177C40.7803 23.4034 42.5721 24.1308 44.5161 24.1308C49.4014 24.1308 52.8836 20.4598 52.8836 15.3002C52.8836 10.1405 49.4014 6.4695 44.5161 6.4695C42.5721 6.4695 40.7803 7.19693 39.5801 8.4657V6.84167H35.0837V27.5818ZM44.533 16.8735C43.6371 16.8735 42.8933 16.1291 42.8933 15.2325C42.8933 14.3359 43.6202 13.5915 44.533 13.5915C45.4458 13.5915 46.1727 14.3359 46.1727 15.2325C46.1727 16.1291 45.4628 16.8735 44.533 16.8735Z"
                    fill="white"
                  />
                  <path
                    d="M73.4727 6.78277H77.9692V9.01581C78.9154 7.3072 80.9446 6.29218 83.0738 6.49519V10.6229C80.1162 10.1831 77.9692 11.7902 77.9692 14.4462V23.6998H73.4727V6.78277ZM16.6921 17.1698V6.78277H21.1885V16.5438C21.1885 19.1491 22.2197 20.4009 24.1806 20.4009C26.2936 20.4009 27.8825 18.6754 27.8825 16.3747V6.78277H32.379V23.6998H27.8825V21.3314C26.8852 23.04 24.9582 24.0719 22.9973 24.0719C18.9742 24.0719 16.6921 21.5682 16.6921 17.1698Z"
                    fill="white"
                  />
                  <path
                    d="M12.221 14.7081C11.3758 14.2259 10.3363 13.8368 9.09549 13.5408C8.19957 13.2938 7.4879 13.0654 6.9588 12.8557C6.42971 12.6459 6.05614 12.4243 5.833 12.1891C5.60987 11.954 5.4983 11.6884 5.4983 11.3923C5.4983 10.9474 5.68931 10.5956 6.07134 10.3367C6.45337 10.0779 6.99937 9.94763 7.71103 9.94763C8.34326 9.94763 9.06841 10.083 9.88657 10.3553C10.703 10.6277 11.4417 11.01 12.101 11.504L14.3171 8.46739C13.4466 7.82455 12.4391 7.33057 11.2913 6.98547C10.1452 6.64374 8.98049 6.4695 7.79387 6.4695C6.4483 6.4695 5.2684 6.68603 4.25417 7.11742C3.23993 7.55049 2.4353 8.14259 1.84027 8.8937C1.24694 9.6482 0.95112 10.5177 0.95112 11.504C0.95112 12.4903 1.18778 13.3699 1.66278 14.0585C2.13778 14.7504 2.8224 15.3188 3.72 15.7637C4.61591 16.2086 5.69777 16.5909 6.96388 16.9124C7.80572 17.1593 8.47172 17.3758 8.96026 17.5602C9.4488 17.7464 9.79026 17.9443 9.98803 18.1524C10.1858 18.3622 10.2838 18.6277 10.2838 18.9492C10.2838 19.4685 10.0472 19.8813 9.57218 20.1908C9.09718 20.5005 8.46495 20.6544 7.67384 20.6544C6.77794 20.6544 5.86174 20.4683 4.92526 20.0978C3.99047 19.7273 3.09793 19.208 2.25611 18.5415L0.00280762 21.6508C1.18947 22.4915 2.41501 23.1124 3.68112 23.5202C4.94723 23.9278 6.27757 24.1308 7.67384 24.1308C9.94064 24.1308 11.7021 23.6436 12.953 22.6692C14.2056 21.6931 14.831 20.4175 14.831 18.8358C14.831 17.9223 14.6079 17.1272 14.1583 16.4472C13.7086 15.7671 13.0646 15.1868 12.2193 14.7047V14.7098L12.221 14.7081Z"
                    fill="white"
                  />
                  <path
                    d="M70.3353 10.8019C69.5814 9.46887 68.5654 8.41326 67.2824 7.63507C66.001 6.85859 64.544 6.4695 62.9161 6.4695C61.2882 6.4695 59.8564 6.85859 58.5498 7.63507C57.2431 8.41326 56.2069 9.47395 55.4411 10.8205C54.6754 12.1654 54.295 13.666 54.295 15.3188C54.295 16.9715 54.6889 18.467 55.48 19.7984C56.2694 21.1332 57.3547 22.1871 58.7374 22.9652C60.1185 23.7435 61.6737 24.1308 63.3995 24.1308C64.7333 24.1308 65.9774 23.9025 67.1354 23.4457C68.2933 22.9889 69.3311 22.3156 70.244 21.4275L67.727 18.6869C67.0846 19.3044 66.4 19.7561 65.6731 20.0403C64.9446 20.3245 64.15 20.4666 63.2863 20.4666C62.3481 20.4666 61.5164 20.245 60.7879 19.8001C60.0593 19.3552 59.4812 18.7495 59.0484 17.9866C58.8524 17.6415 58.707 17.2693 58.5988 16.8768H71.314C71.363 16.6552 71.4002 16.4015 71.4256 16.1172C71.4492 15.8331 71.4627 15.5556 71.4627 15.2832C71.4627 13.6305 71.0858 12.135 70.3353 10.8036H70.337L70.3353 10.8019ZM58.6039 13.6541C58.6968 13.2955 58.8203 12.9555 58.9757 12.6374C59.3578 11.8592 59.8954 11.2435 60.585 10.7867C61.2764 10.33 62.0404 10.1016 62.8789 10.1016C63.768 10.1016 64.549 10.33 65.2286 10.7867C65.9081 11.2435 66.4423 11.8491 66.8378 12.6002C67.0119 12.9301 67.1455 13.2853 67.2435 13.6541H58.6039Z"
                    fill="white"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_262_1144">
                    <rect
                      width="83.0769"
                      height="22"
                      fill="white"
                      transform="translate(0 6)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </a>
          </li>
        </ul>
      </nav>
    </header>
    <main>
      <section class="hero">
        <span class="hero__label u-text-xs">YOUR YEAR with SUPER</span>
        <h1 class="u-text-h1">Super Wrapped 2025</h1>
        <p class="hero__body">
          A look back at the moments, patterns, and impact that shaped your year
          at work. We’re spotlighting the small moments, big wins, and quiet
          impact that made your year yours across your tools and teams.
        </p>
        <NuxtLink to="" class="hero__button c-button">
          Unwrap your year
        </NuxtLink>
        <div ref="sectionIntegrations" id="js-apps" class="hero__apps" />
      </section>
    </main>
    <footer class="footer">
      <!-- <p class="u-text-sm">© Slite {{ new Date().getFullYear() }}</p> -->
    </footer>
  </div>
</template>

<script setup>
import { ref, onMounted, onBeforeUnmount } from "vue";
import Matter from "matter-js";

const initializedMatterEngine = ref(false);

const initMatterPhysicsEngine = () => {
  const integrations = [
    "web",
    "intercom",
    "notion",
    "jira",
    "slite",
    "slack",
    "linear",
    "github",
    "confluence",
    "google-drive",
  ];

  const Engine = Matter.Engine;
  const Render = Matter.Render;
  const Runner = Matter.Runner;
  const MouseConstraint = Matter.MouseConstraint;
  const Mouse = Matter.Mouse;
  const Composite = Matter.Composite;
  const Bodies = Matter.Bodies;
  const Events = Matter.Events;

  // Create an engine
  const engine = Engine.create();
  engine.world.gravity.y = 1.1;

  // Get container and calculate dimensions
  const container = document.getElementById("js-apps");
  let containerWidth = container.offsetWidth;
  let containerHeight = container.offsetHeight || window.innerHeight * 0.6; // Fallback height if not set

  // Calculate circle size based on container width
  const windowWidth = window.innerWidth;
  const sizeMultiplier = windowWidth > 720 ? 1 : windowWidth / 750;
  const baseCircleSize = 55.5;
  const circleSize = 62 * sizeMultiplier;
  const circleScale = circleSize / baseCircleSize;

  // Create a renderer
  const render = Render.create({
    element: container,
    engine,
    options: {
      width: containerWidth,
      height: containerHeight,
      wireframes: false,
      background: "transparent",
      pixelRatio: "auto",
    },
  });

  // render.canvas.style.pointerEvents = "none";

  // Create rigid bodies
  const bodiesArray = [];

  for (let index = 0; index < 1; index++) {
    integrations.forEach((integration) => {
      const circle = Bodies.circle(
        Math.random() * containerWidth,
        -containerHeight * 0.5,
        circleSize,
        {
          render: {
            sprite: {
              texture: `images/icons/${integration}.svg`,
              xScale: circleScale,
              yScale: circleScale,
            },
          },
        }
      );
      circle.restitution = 0.7;
      bodiesArray.push(circle);
    });
  }

  // Create boundaries scaled to container size
  const ground = Bodies.rectangle(
    containerWidth / 2,
    containerHeight,
    containerWidth * 1.2,
    containerHeight * 0.008,
    {
      isStatic: true,
      render: { fillStyle: "transparent" },
    }
  );

  const roof = Bodies.rectangle(
    containerWidth / 2,
    -containerHeight * 0.7,
    containerWidth * 1.2,
    containerHeight * 0.1,
    {
      isStatic: true,
      render: { fillStyle: "white" },
    }
  );

  const leftWall = Bodies.rectangle(
    0,
    containerHeight / 2,
    containerWidth * 0.01,
    containerHeight * 2,
    {
      isStatic: true,
      render: { fillStyle: "transparent" },
    }
  );

  const rightWall = Bodies.rectangle(
    containerWidth,
    containerHeight / 2,
    containerWidth * 0.01,
    containerHeight * 2,
    {
      isStatic: true,
      render: { fillStyle: "transparent" },
    }
  );

  ground.restitution = leftWall.restitution = rightWall.restitution = 1;

  // Add all bodies to the world
  Composite.add(engine.world, [
    ...bodiesArray,
    ground,
    roof,
    leftWall,
    rightWall,
  ]);

  // Add mouse control
  const mouse = Mouse.create(render.canvas);
  const mouseConstraint = MouseConstraint.create(engine, {
    mouse,
    constraint: {
      stiffness: 0.2,
      render: {
        visible: false,
      },
    },
  });

  // Disable scrolling when interacting with canvas
  mouseConstraint.mouse.element.removeEventListener(
    "mousewheel",
    mouseConstraint.mouse.mousewheel
  );
  mouseConstraint.mouse.element.removeEventListener(
    "DOMMouseScroll",
    mouseConstraint.mouse.mousewheel
  );

  Composite.add(engine.world, mouseConstraint);
  render.mouse = mouse;

  // Run the renderer and engine
  Render.run(render);
  const runner = Runner.create();
  Runner.run(runner, engine);
};

onMounted(() => {
  if (!initializedMatterEngine.value) {
    initMatterPhysicsEngine();
    initializedMatterEngine.value = true;
  }

  // let prevWidth = window.innerWidth;
  // window.addEventListener("resize", () => {
  //   const newWidth = window.innerWidth;
  //   if (newWidth === prevWidth) return;

  //   const container = document.getElementById("js-apps");
  //   if (container) container.innerHTML = "";
  //   // initMatterPhysicsEngine();

  //   prevWidth = newWidth;
  // });
});
</script>

<style lang="scss" scoped>
.home {
  height: 100dvh;
  padding: 8rem 2rem 2rem;

  .header {
    margin: 0 auto;
    width: fit-content;

    .nav__menu {
      display: inline-flex;
      list-style: none;
      padding: 0;
    }
  }

  .hero {
    position: relative;
    display: flex;
    align-items: center;
    flex-direction: column;
    text-align: center;
    gap: 24px;
    border: 1px dashed #cdcdcd75;
    margin: 60px auto 0;
    width: 100%;
    height: 70vh;
    max-width: 1200px;
    border-radius: 50px;
    overflow: hidden;

    &__label {
      text-transform: uppercase;
      margin-top: 8.6rem;
      visibility: hidden;
      color: line;
      background: linear-gradient(
        to right,
        var(--color-pink-nebula) 0%,
        var(--color-pink-moon) 30%,
        var(--color-light-blue) 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    &__body {
      max-width: 740px;
    }

    &__button {
      margin-top: 12px;
      z-index: 2;
    }

    &__apps {
      position: absolute;
      width: 100%;
      height: 100%;
    }
  }
}
</style>
